<!DOCTYPE html>
<html>
<head>
    <title>WoW Class Polls</title>
    <style>
        body {
            background-color: #1a1f2b;
            color: white;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }

        .settings {
            margin-bottom: 20px;
            padding: 10px;
            background-color: #2c3142;
            border-radius: 5px;
            display: flex;
            gap: 10px;
        }

        .webhook-input {
            flex: 1;
            padding: 5px;
            background-color: #1a1f2b;
            border: 1px solid #3d4356;
            color: white;
            border-radius: 3px;
        }

        h1, h2 {
            color: #00b0f4;
        }

        .class-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .class-box {
            background-color: #2c3142;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #3d4356;
        }

        input[type="number"] {
            background-color: #1a1f2b;
            border: 1px solid #3d4356;
            color: white;
            padding: 5px;
            width: 60px;
            margin: 0 5px;
            border-radius: 3px;
        }

        .status-message {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 20px;
            border-radius: 5px;
            display: none;
            animation: fadeOut 3s forwards;
        }

        .success { background-color: #43b581; }
        .error { background-color: #f04747; }

        @keyframes fadeOut {
            0% { opacity: 1; }
            70% { opacity: 1; }
            100% { opacity: 0; }
        }
    </style>
</head>
<body>
    <div class="settings">
        <input type="text" id="webhookUrl" class="webhook-input" placeholder="Enter Discord Webhook URL">
    </div>

    <h1>World of Warcraft Class Polls</h1>

    <h2>Mists of Pandaria Classes (5.4.8)</h2>
    <div class="class-grid">
        <div class="class-box">
            <span>Warrior</span>
            <input type="number" id="mop-warrior" value="0" min="0" max="100" onchange="updateDiscord()">%
        </div>
        <div class="class-box">
            <span>Paladin</span>
            <input type="number" id="mop-paladin" value="0" min="0" max="100" onchange="updateDiscord()">%
        </div>
        <div class="class-box">
            <span>Hunter</span>
            <input type="number" id="mop-hunter" value="0" min="0" max="100" onchange="updateDiscord()">%
        </div>
        <div class="class-box">
            <span>Rogue</span>
            <input type="number" id="mop-rogue" value="0" min="0" max="100" onchange="updateDiscord()">%
        </div>
        <div class="class-box">
            <span>Priest</span>
            <input type="number" id="mop-priest" value="0" min="0" max="100" onchange="updateDiscord()">%
        </div>
        <div class="class-box">
            <span>Death Knight</span>
            <input type="number" id="mop-deathknight" value="0" min="0" max="100" onchange="updateDiscord()">%
        </div>
        <div class="class-box">
            <span>Shaman</span>
            <input type="number" id="mop-shaman" value="0" min="0" max="100" onchange="updateDiscord()">%
        </div>
        <div class="class-box">
            <span>Mage</span>
            <input type="number" id="mop-mage" value="0" min="0" max="100" onchange="updateDiscord()">%
        </div>
        <div class="class-box">
            <span>Warlock</span>
            <input type="number" id="mop-warlock" value="0" min="0" max="100" onchange="updateDiscord()">%
        </div>
        <div class="class-box">
            <span>Monk</span>
            <input type="number" id="mop-monk" value="0" min="0" max="100" onchange="updateDiscord()">%
        </div>
        <div class="class-box">
            <span>Druid</span>
            <input type="number" id="mop-druid" value="0" min="0" max="100" onchange="updateDiscord()">%
        </div>
    </div>

    <h2>Wrath of the Lich King Classes</h2>
    <div class="class-grid">
        <div class="class-box">
            <span>Warrior</span>
            <input type="number" id="wotlk-warrior" value="0" min="0" max="100" onchange="updateDiscord()">%
        </div>
        <div class="class-box">
            <span>Paladin</span>
            <input type="number" id="wotlk-paladin" value="0" min="0" max="100" onchange="updateDiscord()">%
        </div>
        <div class="class-box">
            <span>Hunter</span>
            <input type="number" id="wotlk-hunter" value="0" min="0" max="100" onchange="updateDiscord()">%
        </div>
        <div class="class-box">
            <span>Rogue</span>
            <input type="number" id="wotlk-rogue" value="0" min="0" max="100" onchange="updateDiscord()">%
        </div>
        <div class="class-box">
            <span>Priest</span>
            <input type="number" id="wotlk-priest" value="0" min="0" max="100" onchange="updateDiscord()">%
        </div>
        <div class="class-box">
            <span>Death Knight</span>
            <input type="number" id="wotlk-deathknight" value="0" min="0" max="100" onchange="updateDiscord()">%
        </div>
        <div class="class-box">
            <span>Shaman</span>
            <input type="number" id="wotlk-shaman" value="0" min="0" max="100" onchange="updateDiscord()">%
        </div>
        <div class="class-box">
            <span>Mage</span>
            <input type="number" id="wotlk-mage" value="0" min="0" max="100" onchange="updateDiscord()">%
        </div>
        <div class="class-box">
            <span>Warlock</span>
            <input type="number" id="wotlk-warlock" value="0" min="0" max="100" onchange="updateDiscord()">%
        </div>
        <div class="class-box">
            <span>Druid</span>
            <input type="number" id="wotlk-druid" value="0" min="0" max="100" onchange="updateDiscord()">%
        </div>
    </div>

    <div id="statusMessage" class="status-message"></div>

    <script>
        let updateTimeout;
        let messageId = localStorage.getItem('lastMessageId');

        function showStatus(message, isError = false) {
            const statusElement = document.getElementById('statusMessage');
            statusElement.textContent = message;
            statusElement.className = 'status-message ' + (isError ? 'error' : 'success');
            statusElement.style.display = 'block';
            
            setTimeout(() => {
                statusElement.style.display = 'none';
            }, 3000);
        }

        function getClassData(prefix) {
            return {
                warrior: document.getElementById(prefix + '-warrior').value,
                paladin: document.getElementById(prefix + '-paladin').value,
                hunter: document.getElementById(prefix + '-hunter').value,
                rogue: document.getElementById(prefix + '-rogue').value,
                priest: document.getElementById(prefix + '-priest').value,
                deathknight: document.getElementById(prefix + '-deathknight').value,
                shaman: document.getElementById(prefix + '-shaman').value,
                mage: document.getElementById(prefix + '-mage').value,
                warlock: document.getElementById(prefix + '-warlock').value,
                ...(prefix === 'mop' ? { monk: document.getElementById('mop-monk').value } : {}),
                druid: document.getElementById(prefix + '-druid').value
            };
        }

        function createEmbed() {
            const mopData = getClassData('mop');
            const wotlkData = getClassData('wotlk');

            return {
                title: "WoW Class Distribution Stats",
                color: 3447003,
                fields: [
                    {
                        name: "__Mists of Pandaria (5.4.8)__",
                        value: Object.entries(mopData)
                            .map(([className, value]) => {
                                const emoji = {
                                    warrior: 'ðŸ—¡ï¸',
                                    paladin: 'ðŸ›¡ï¸',
                                    hunter: 'ðŸ¹',
                                    rogue: 'ðŸ—¡ï¸',
                                    priest: 'âœ¨',
                                    deathknight: 'ðŸ’€',
                                    shaman: 'âš¡',
                                    mage: 'ðŸ”®',
                                    warlock: 'ðŸŒ‘',
                                    monk: 'ðŸ‰',
                                    druid: 'ðŸŒ¿'
                                }[className];
                                return `${emoji} **${className.charAt(0).toUpperCase() + className.slice(1)}:** ${value}%`;
                            })
                            .join('\n'),
                        inline: true
                    },
                    {
                        name: "__Wrath of the Lich King__",
                        value: Object.entries(wotlkData)
                            .map(([className, value]) => {
                                const emoji = {
                                    warrior: 'ðŸ—¡ï¸',
                                    paladin: 'ðŸ›¡ï¸',
                                    hunter: 'ðŸ¹',
                                    rogue: 'ðŸ—¡ï¸',
                                    priest: 'âœ¨',
                                    deathknight: 'ðŸ’€',
                                    shaman: 'âš¡',
                                    mage: 'ðŸ”®',
                                    warlock: 'ðŸŒ‘',
                                    druid: 'ðŸŒ¿'
                                }[className];
                                return `${emoji} **${className.charAt(0).toUpperCase() + className.slice(1)}:** ${value}%`;
                            })
                            .join('\n'),
                        inline: true
                    }
                ],
                timestamp: new Date().toISOString(),
                footer: {
                    text: "Last updated"
                }
            };
        }

        async function updateDiscord() {
            clearTimeout(updateTimeout);
            updateTimeout = setTimeout(async () => {
                const webhookUrl = document.getElementById('webhookUrl').value;
                if (!webhookUrl) {
                    showStatus('Please enter a Discord webhook URL', true);
                    return;
                }

                const embed = createEmbed();
                const payload = { embeds: [embed] };

                try {
                    if (messageId) {
                        // Edit existing message
                        const response = await fetch(`${webhookUrl}/messages/${messageId}`, {
                            method: 'PATCH',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (!response.ok) {
                            throw new Error('Failed to edit message');
                        }
                    } else {
                        // Create new message
                        const response = await fetch(webhookUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (!response.ok) {
                            throw new Error('Failed to send message');
                        }

                        const data = await response.json();
                        messageId = data.id;
                        localStorage.setItem('lastMessageId', messageId);
                    }

                    showStatus('Updated Discord successfully!');
                } catch (error) {
                    showStatus('Error updating Discord: ' + error.message, true);
                    if (error.message.includes('Failed to edit')) {
                        // If editing fails, try sending a new message
                        messageId = null;
                        localStorage.removeItem('lastMessageId');
                        updateDiscord();
                    }
                }
            }, 1000);
        }

        // Save webhook URL to localStorage
        document.getElementById('webhookUrl').value = localStorage.getItem('webhookUrl') || '';
        document.getElementById('webhookUrl').addEventListener('change', (e) => {
            localStorage.setItem('webhookUrl', e.target.value);
        });
    </script>
</body>
</html>
